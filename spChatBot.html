<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OGC Smart Chatbot</title>
    <style>
      .rw-conversation-container .rw-header {
        background-color: rgb(0, 70, 239) !important;
        color: white !important;
      }
    </style>
  </head>
  <body>
    <div id="popupImg"></div>
    <script>
      let listImg = [];
      let list = [];
      function handleViewImg(e) {
        e.preventDefault();
        let image = e.target.currentSrc;
        let Image = document.getElementById("popupImg");
        let viewImage = document.getElementById("popupImg");
        viewImage.innerHTML = `<div className="popup-img" style="position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          width: 100% !important;
          height: 100vh !important;
          background-color: rgba(0, 0, 0, 0.6);
          display: flex !important;
          justify-content: center !important;
          align-items: center !important;
          z-index: 100000 !important;">
        <div>
          <div>
            <a className="close-img" onclick="handleClose()" style="position: absolute !important;
            top: 20px !important;
            right: 20px !important;
            text-decoration: none !important; 
            cursor: pointer !important;
            z-index: 100002 !important;">
              &#10060;
            </a>
          </div>
          <div>
            <img className="popup-inner-img" src="${image}" style="position: relative !important;
              width: 100% !important;
              max-width: 900px !important;
              max-height: 700px !important;
              object-fit: fill !important;
              border-radius: 15px !important;
              text-align: center !important;
              z-index: 100001 !important;"></img>
          </div>
        </div>
      </div>`;
      }

      function handleClose() {
        let closeImage = document.getElementById("popupImg");
        closeImage.removeChild(closeImage.firstElementChild);
      }

      function addEventToImg() {
        let elementImg = document.getElementsByClassName("rw-image-frame");
        for (let i = 0; i < elementImg.length; i++) {
          elementImg[i].addEventListener("click", e => handleViewImg(e));
        }
        for (let j = 0; j < listImg.length; j++) {
          listImg.pop();
        }
        for (let k = 0; k < list.length; k++) {
          list.pop();
        }
      }
    </script>
    <script>
      !(function () {
        let e = document.createElement("script"),
          t = document.head || document.getElementsByTagName("head")[0];
        (e.src = "https://cdn.jsdelivr.net/npm/rasa-webchat@1.0.1/lib/index.js"),
          // Replace 1.x.x with the version that you want
          (e.async = !0),
          (e.onload = () => {
            window.WebChat.default(
              {
                initPayload: "/greet",
                customData: { language: "en", fullName: `` },
                socketUrl: "https://ogcsmartchatbot-qa-endpoint.pttplc.com/",
                socketPath: "/socket.io/",
                title: "OGC Smart Chatbot",
                showMessageDate: true,
                inputTextFieldHint: "What's in your mind?...",
                profileAvatar: "/image/logo-ptt.png",
                tooltipPayload: "/greet",
                docViewer: true,
                onSocketEvent: {
                  bot_uttered: e => {
                    if (e.text) {
                      list.push(e.text);
                    } else if (e.attachment) {
                      list.push(e.attachment);
                      listImg.push(e.attachment);
                    }
                    console.log(list);
                    if (!list[0].type) {
                      setTimeout(() => addEventToImg(), (listImg.length + 1.5) * 3000);
                    } else if (listImg.length === 1) {
                      setTimeout(() => addEventToImg(), listImg.length * 1000);
                    } else if (listImg.length === 2) {
                      setTimeout(() => addEventToImg(), (listImg.length + 1) * 1000);
                    } else {
                      setTimeout(() => addEventToImg(), (listImg.length + 1.5) * 1000);
                    }
                    console.log(listImg.length);
                  },
                  connect: () => setTimeout(() => this.addEventToImg(), 1500)
                },
                onWidgetEvent: {
                  onChatClose: () => setTimeout(() => this.addEventToImg(), 500),
                  onChatOpen: () => setTimeout(() => this.addEventToImg(), 500)
                }
                // add other props here
              },
              null
            );
          }),
          t.insertBefore(e, t.firstChild);
      })();
    </script>
  </body>
</html>
